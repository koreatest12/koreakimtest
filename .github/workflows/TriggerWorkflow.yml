name: "ğŸ›¡ï¸ DefenderBot Autonomous Patrol Trigger"

on:
  schedule:
    - cron: "0 */6 * * *"  # 24ì‹œê°„ ìˆœí™˜ ê°ì‹œ (6ì‹œê°„ ê°„ê²©)
  workflow_dispatch:       # ìˆ˜ë™ ì‹¤í–‰ ì§€ì›
  push:
    branches: [ "main" ]

permissions:
  contents: write
  packages: write
  id-token: write
  security-events: write
  actions: write # ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œìš° ì œì–´ë¥¼ ìœ„í•´ í•„ìš”

jobs:
  # -----------------------------------------------------------------------------------
  # ì „ëµ ë§¤íŠ¸ë¦­ìŠ¤ ì •ì˜: ë‹¤ì–‘í•œ í™˜ê²½(Variant)ì— ëŒ€í•´ ë³‘ë ¬ë¡œ ìˆœì°° ë° ë°°í¬ ìˆ˜í–‰
  # -----------------------------------------------------------------------------------
  patrol-matrix:
    name: "ğŸš€ Patrol Dispatcher"
    strategy:
      fail-fast: false # í•˜ë‚˜ê°€ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ì§„í–‰
      matrix:
        include:
          - variant: docker
            distro: alpine
            upgrade: "true"
            port: 8080
          - variant: linux
            distro: ubuntu-22.04
            upgrade: "true"
            port: 22
          - variant: java
            distro: temurin-17
            upgrade: "true"
            port: 8081
          - variant: python
            distro: python-3.9
            upgrade: "true"
            port: 5000

    # ì¬ì‚¬ìš© ì›Œí¬í”Œë¡œìš° í˜¸ì¶œ
    uses: ./.github/workflows/defenderbot.yml
    with:
      variant: ${{ matrix.variant }}
      distro: ${{ matrix.distro }}
      upgrade: ${{ matrix.upgrade }}
      service_port: ${{ matrix.port }}
      release_tag: "v-${{ github.run_number }}"
    secrets: inherit
