name: OpenClaw Mass Generation Workflow

on:
  workflow_dispatch: # 수동으로 매개변수를 입력하여 실행
    inputs:
      gen_count:
        description: '생성할 개수 (Mass Generation Count)'
        required: true
        default: '5'

jobs:
  mass-generate:
    runs-on: ubuntu-latest

    steps:
      # 1. 현재 작업 저장소 체크아웃
      - name: Checkout Current Repository
        uses: actions/checkout@v4

      # 2. OpenClaw 원본 저장소 복제 (Recursive로 서브모듈까지 포함)
      - name: Clone OpenClaw Repository
        run: |
          git clone --recursive https://github.com/koreatest12/openclaw.git openclaw_src
          echo "OpenClaw source cloned successfully."

      # 3. Node.js 환경 설정
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # 4. 복제된 OpenClaw 디렉토리에서 의존성 설치
      - name: Install OpenClaw Dependencies
        run: |
          cd openclaw_src
          npm install
          # 대량 생성을 위해 필요한 추가 패키지가 있다면 여기서 설치
          # npm install some-mass-gen-tool 

      # 5. 대량 생성 실행 로직 (Mass Generation)
      # 저장소 내의 특정 실행 스크립트(예: gen.js)가 있다고 가정합니다.
      - name: Execute Mass Generation
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }} # API 키가 필요할 경우 설정
          GEN_COUNT: ${{ github.event.inputs.gen_count }}
        run: |
          cd openclaw_src
          echo "Starting mass generation for $GEN_COUNT items..."
          
          # 예시: 반복문을 통해 대량 생성 스크립트 실행
          # 실제 실행 파일명에 맞춰 'node index.js' 등을 수정하세요.
          for i in $(seq 1 $GEN_COUNT)
          do
            echo "Generating item $i..."
            # node your-gen-script.js --id=$i  <-- 실제 실행 명령어로 교체 필요
          done

      # 6. 생성된 결과물 저장 (Artifacts)
      - name: Upload Generated Results
        uses: actions/upload-artifact@v4
        with:
          name: mass-gen-output
          path: openclaw_src/output/ # 결과물이 저장되는 경로로 수정
