name: "ğŸ›¡ï¸ DefenderBot Patrol Dispatcher"

on:
  schedule:
    - cron: "0 */6 * * *"  # 6ì‹œê°„ ê°„ê²©
  workflow_dispatch:       # ìˆ˜ë™ ì‹¤í–‰
  push:
    branches: [ "main", "develop" ]

permissions:
  contents: write
  packages: write
  id-token: write
  security-events: write

jobs:
  # -----------------------------------------------------------------------------------
  # Matrix Strategy: ë‹¤ì–‘í•œ í™˜ê²½ì— ëŒ€í•œ ë³‘ë ¬ ìˆœì°° ë° ë°°í¬
  # -----------------------------------------------------------------------------------
  patrol-matrix:
    name: "ğŸš€ Dispatch Patrol"
    strategy:
      fail-fast: false # í•˜ë‚˜ì˜ ì‘ì—…ì´ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ì§„í–‰ (ì¬ìˆ˜í–‰ ë³´ì¥)
      matrix:
        include:
          - variant: docker
            distro: alpine:latest
            upgrade: "true"
            port: "8080"
          - variant: linux
            distro: ubuntu:22.04
            upgrade: "true"
            port: "22"
          - variant: java
            distro: temurin-17
            upgrade: "false"
            port: "8081"
          - variant: python
            distro: python-3.9
            upgrade: "true"
            port: "5000"

    # [ìˆ˜ì •ë¨] inputs ì •ì˜ê°€ ì™„ë£Œëœ defenderbot.ymlì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
    uses: ./.github/workflows/defenderbot.yml
    with:
      variant: ${{ matrix.variant }}
      distro: ${{ matrix.distro }}
      upgrade: ${{ matrix.upgrade }}
      service_port: ${{ matrix.port }}  # ì—ëŸ¬ê°€ ë‚¬ë˜ ë¶€ë¶„ í•´ê²°ë¨
      release_tag: "v-${{ github.run_number }}"
    secrets: inherit
