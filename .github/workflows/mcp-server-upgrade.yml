name: "ğŸ”„ DR Ops: Restore from Backup"

on:
  workflow_dispatch:
    inputs:
      backup_id:
        description: 'ë³µì›í•  ë°±ì—… ID (GitHub Artifact Name)'
        required: true
        default: 'finance-ops-backup'

jobs:
  disaster-recovery:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Download Backup Data
        uses: actions/download-artifact@v4
        with:
          name: ${{ github.event.inputs.backup_id }}
          path: ./restore-point

      - name: ğŸ”“ Unpack & Restore Environment
        run: |
          echo "Restoring System from Backup..."
          mkdir -p ./restored-workspace
          
          # ì••ì¶• í•´ì œ
          tar -xzf ./restore-point/*.tar.gz -C ./restored-workspace
          
          echo "âœ… Filesystem Restored."
          ls -R ./restored-workspace

      - name: ğŸ³ Restore & Run Containers
        run: |
          # ë³µêµ¬ëœ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ë¡œë“œ (ì˜ˆì‹œ ë¡œì§)
          find ./restored-workspace -name "*.tar" | while read image; do
            echo "Loading image: $image"
            docker load -i "$image"
          done
          
          # ì„œë¹„ìŠ¤ ê¸´ê¸‰ ì¬ê°€ë™
          docker run -d --name recovered-service finance-service-app:latest || echo "Image load required first"

      - name: ğŸ“¢ Notify Recovery Status
        run: echo "System restored from ${{ github.event.inputs.backup_id }}"
