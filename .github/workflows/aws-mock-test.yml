name: "AWS Full Mock Simulation — No Real Tokens Needed"

on:
  workflow_dispatch:
    inputs:
      loops:
        description: "반복 횟수"
        default: "20"
      services:
        description: "테스트 서비스 (all/mock)"
        default: "all"

jobs:
  full_mock_test:
    runs-on: ubuntu-latest

    steps:
      - name: Init Mock System
        shell: bash
        run: |
          echo "== INIT MOCK SYSTEM =="
          echo "Loops: ${{ github.event.inputs.loops }}"
          mkdir -p mock_tokens mock_services mock_logs

      - name: Generate Fake AWS Tokens
        shell: bash
        run: |
          echo "== GENERATE FAKE AWS TOKENS =="
          echo "export AWS_ACCESS_KEY_ID=FAKEKEY-$RANDOM$RANDOM" > mock_tokens/aws.env
          echo "export AWS_SECRET_ACCESS_KEY=FAKESECRET-$RANDOM$RANDOM$RANDOM" >> mock_tokens/aws.env
          echo "export AWS_SESSION_TOKEN=FAKESESSION-$RANDOM$RANDOM" >> mock_tokens/aws.env
          cat mock_tokens/aws.env

      - name: Mock Install All AWS Free Services
        shell: bash
        run: |
          echo "== INSTALL MOCK SERVICES =="
          for svc in lambda sqs sns dynamodb apigw iam sts cloudwatch codebuild codecommit glue xray; do
            echo "Installing mock $svc service ..."
            touch mock_services/$svc.installed
          done

      - name: Mock Lambda Invoke
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[Lambda MOCK] invoke function mockFn-$i :: payload={id:$i}"
          done

      - name: Mock SQS
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[SQS MOCK] queue=myq :: send message=hello-$i"
          done

      - name: Mock SNS
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[SNS MOCK] topic=myTopic :: publish=notify-$i"
          done

      - name: Mock API Gateway
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[API-GW MOCK] GET /mock/api/$i :: status=200"
          done

      - name: Mock DynamoDB
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[DynamoDB MOCK] table=Users :: key=user-$i :: result=mock-data"
          done

      - name: Mock CloudWatch Logs
        shell: bash
        run: |
          for i in $(seq 1 ${{ github.event.inputs.loops }}); do
            echo "[CloudWatch MOCK] log_event=/aws/mock/$i :: message='event-$i'"
          done

      - name: Mock IAM
        shell: bash
        run: |
          echo "[IAM MOCK] list-users"
          echo "[IAM MOCK] list-roles"
          echo "[IAM MOCK] simulate-policy"

      - name: Mock STS
        shell: bash
        run: |
          echo "[STS MOCK] get-caller-identity :: arn=fake:aws:iam::123456789012:user/mock"

      - name: Mock CodeBuild
        shell: bash
        run: |
          echo "[CodeBuild MOCK] build-start :: project=mock-build"
          echo "[CodeBuild MOCK] build-complete :: status=SUCCESS"

      - name: Mock Glue Data Catalog
        shell: bash
        run: |
          echo "[Glue MOCK] list-databases"
          echo "[Glue MOCK] list-tables"

      - name: Mock X-Ray
        shell: bash
        run: |
          echo "[X-Ray MOCK] trace=mock-trace-id :: segments=3"

      - name: End
        shell: bash
        run: |
          echo "== ALL MOCK AWS SERVICES COMPLETE =="
