name: Download Apache Maven

on:
  workflow_dispatch:
    inputs:
      maven-version:
        description: "Apache Maven version to download (예: 3.9.6)"
        required: true
        default: "3.9.6"

jobs:
  fetch-maven:
    runs-on: ubuntu-latest

    # ✅ Maven 공식 다운로드 URL (정식 주소)
    env:
      MAVEN_BASE_URL: https://downloads.apache.org/maven/maven-3

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create dump directory
        run: mkdir -p dump

      - name: Determine Maven download URL
        id: maven
        run: |
          set -euo pipefail

          # workflow_dispatch 입력값 사용
          VERSION="${{ github.event.inputs.maven-version }}"
          echo "Selected Maven version: ${VERSION}"

          URL="${MAVEN_BASE_URL}/${VERSION}/binaries/apache-maven-${VERSION}-bin.tar.gz"
          echo "Resolved URL: ${URL}"

          # GitHub Actions outputs로 전달
          {
            echo "version=${VERSION}"
            echo "url=${URL}"
          } >> "$GITHUB_OUTPUT"

      - name: Download Apache Maven archive
        run: |
          set -euo pipefail
          echo "Downloading: ${{ steps.maven.outputs.url }}"
          curl -fL "${{ steps.maven.outputs.url }}" \
            -o "dump/apache-maven-${{ steps.maven.outputs.version }}-bin.tar.gz"

      - name: List dump directory contents
        run: ls -lh dump
