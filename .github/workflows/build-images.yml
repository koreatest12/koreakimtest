name: "ğŸ“¦ Maven Manual Setup & Project Generator"

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™”
  push:
    branches: [ "main" ]

env:
  MAVEN_VERSION: '3.9.6'
  JAVA_VERSION: '17'
  PROJECT_ROOT: 'generated-project'

jobs:
  maven-setup-and-generate:
    runs-on: ubuntu-latest
    name: ğŸ› ï¸ Setup Maven & Generate Files

    steps:
      # 1. ì²´í¬ì•„ì›ƒ (ê¸°ë³¸)
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # 2. JDK ì„¤ì • (Maven ì‹¤í–‰ì„ ìœ„í•´ í•„ìˆ˜)
      - name: â˜• Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'

      # 3. Maven ìˆ˜ë™ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜
      # GitHub Runnerì— ê¸°ë³¸ Mavenì´ ìˆì§€ë§Œ, ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ/ì„¤ì¹˜ ê³¼ì •ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
      - name: â¬‡ï¸ Download & Install Apache Maven
        run: |
          echo "Downloading Maven ${MAVEN_VERSION}..."
          wget -q https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz
          
          echo "Extracting Maven..."
          tar -xzf apache-maven-${MAVEN_VERSION}-bin.tar.gz
          
          echo "Setting up Path..."
          # í˜„ì¬ Jobì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
          echo "$(pwd)/apache-maven-${MAVEN_VERSION}/bin" >> $GITHUB_PATH
          
          # ì„¤ì¹˜ í™•ì¸
          export PATH="$(pwd)/apache-maven-${MAVEN_VERSION}/bin:$PATH"
          mvn -version

      # 4. í•„ìˆ˜ ë””ë ‰í† ë¦¬ êµ¬ì¡° ëŒ€ëŸ‰ ìƒì„±
      # Mavenì˜ í‘œì¤€ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      - name: ğŸ“‚ Create Directory Structure
        run: |
          echo "Creating project directories under ${PROJECT_ROOT}..."
          
          # ë©”ì¸ ì†ŒìŠ¤ ë° ë¦¬ì†ŒìŠ¤ ë””ë ‰í† ë¦¬
          mkdir -p ${PROJECT_ROOT}/src/main/java/com/example/demo
          mkdir -p ${PROJECT_ROOT}/src/main/resources
          
          # í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬
          mkdir -p ${PROJECT_ROOT}/src/test/java/com/example/demo
          
          # ë¡œê·¸ ë° ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ìš© ë””ë ‰í† ë¦¬ (ì˜ˆì‹œ)
          mkdir -p ${PROJECT_ROOT}/logs
          mkdir -p ${PROJECT_ROOT}/config
          mkdir -p ${PROJECT_ROOT}/scripts
          
          echo "âœ… Directories created:"
          find ${PROJECT_ROOT} -maxdepth 4 -type d

      

      # 5. í•„ìˆ˜ íŒŒì¼ ìƒì„± (pom.xml)
      # ë¹Œë“œì— í•„ìš”í•œ í•µì‹¬ ì„¤ì • íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
      - name: ğŸ“„ Generate pom.xml
        run: |
          cat <<EOF > ${PROJECT_ROOT}/pom.xml
          <project xmlns="http://maven.apache.org/POM/4.0.0"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
              <modelVersion>4.0.0</modelVersion>
          
              <groupId>com.example</groupId>
              <artifactId>demo-project</artifactId>
              <version>1.0.0-SNAPSHOT</version>
          
              <properties>
                  <maven.compiler.source>${JAVA_VERSION}</maven.compiler.source>
                  <maven.compiler.target>${JAVA_VERSION}</maven.compiler.target>
                  <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
              </properties>

              <dependencies>
                  <dependency>
                      <groupId>org.slf4j</groupId>
                      <artifactId>slf4j-api</artifactId>
                      <version>2.0.9</version>
                  </dependency>
              </dependencies>
          </project>
          EOF
          echo "âœ… pom.xml generated."

      # 6. Java ì†ŒìŠ¤ íŒŒì¼ ìƒì„±
      # ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ Main í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      - name: ğŸ“ Generate Java Source Code
        run: |
          cat <<EOF > ${PROJECT_ROOT}/src/main/java/com/example/demo/App.java
          package com.example.demo;

          public class App {
              public static void main(String[] args) {
                  System.out.println("ğŸš€ Maven Build Success via GitHub Actions!");
                  System.out.println("System Time: " + java.time.LocalDateTime.now());
              }
          }
          EOF
          echo "âœ… Java source file generated."

      # 7. ì„¤ì • íŒŒì¼ ìƒì„± (settings.xml ë“±)
      - name: âš™ï¸ Generate Config Files
        run: |
          # ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • íŒŒì¼ ì˜ˆì‹œ
          echo "app.env=production" > ${PROJECT_ROOT}/src/main/resources/application.properties
          
          # ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì˜ˆì‹œ
          echo "#!/bin/bash" > ${PROJECT_ROOT}/scripts/run.sh
          echo "java -cp target/demo-project-1.0.0-SNAPSHOT.jar com.example.demo.App" >> ${PROJECT_ROOT}/scripts/run.sh
          chmod +x ${PROJECT_ROOT}/scripts/run.sh
          
          echo "âœ… Config files generated."

      # 8. Maven ë¹Œë“œ ì‹¤í–‰
      # ìœ„ì—ì„œ ìƒì„±í•œ íŒŒì¼ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ ë¹Œë“œë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
      - name: ğŸ—ï¸ Run Maven Build
        working-directory: ${{ env.PROJECT_ROOT }}
        run: |
          mvn clean package -B
          
      # 9. ê²°ê³¼ í™•ì¸ (Java ì‹¤í–‰)
      - name: ğŸš€ Verify Artifact
        working-directory: ${{ env.PROJECT_ROOT }}
        run: |
          echo "Executing the built JAR..."
          java -cp target/demo-project-1.0.0-SNAPSHOT.jar com.example.demo.App

      # 10. ê²°ê³¼ë¬¼ ì—…ë¡œë“œ (ì„ íƒ ì‚¬í•­)
      - name: ğŸ“¤ Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: built-jar
          path: ${{ env.PROJECT_ROOT }}/target/*.jar
